{% extends 'deckbuilder/base.html' %}

{% block head %}
<title>Deckbuilder</title>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<div align="left">
	<a href="/">&lt; back</a>
</div>
<div align="center">
	<h1>Deckbuilder</h1>
</div>
<style>
	body{
			background-image: url("{{ url_for('static', filename='images/deckbuilder_background.jpg') }}");
			background-repeat: no-repeat;
			background-attachment: fixed;
			background-size: cover;
			text-align: center;
  }
	table{
		background-color: beige;
	}
  
</style>
{% endblock %}

{% block body %}
<div class="container">
	<!-- Div for all the user interactions with this page -->
	<div class="forms">
		<h2>Available decks:</h2>
		{{ decks }}
		<h1>Control panel</h1>

		<form method="POST">
			<!-- Add card to selected deck -->
			<h2>Build From Deck Code</h2>
			<label for="deckNameFromCode">New Deck Name:</label>
	    	<input type="text" name="deckNameFromCode">
	    	<label for="deckCode">Deck Code:</label>
	    	<input type="text" name="deckCode">
	    	<button type="submit" class="btn btn-default">Add</button>
	    </form>

		<form method="POST">
			<!-- Creating a new deck -->
			<h2>New Deck</h2>
	    	<input type="text" name="deckName">
	    	<button type="submit" class="btn btn-default">Create</button>
	    </form>

	    <form method="POST">
	    	<!-- Select a deck to view -->
	    	<h2>Select Deck</h2>
			<select id="selectDeck" name="selectDeck" class="selectpicker form-control">
				{% for item in decks %}
				<option value="{{ item }}">{{ item }}</option>
				{% endfor %}
			</select>
			<script>
				var lastVal = $('#selectDeck option:last').val();
				$('#selectDeck').val(lastVal);
			</script>
			<button type="submit" class="btn btn-default">Select</button>

			<!-- Add card to selected deck -->
			<h2>Add Cards</h2>
	    	<input type="text" name="cardID">
	    	<button type="submit" class="btn btn-default">Add</button>

	    	<h2>Delete Card</h2>
	    	<input type="text" name="cardIDDelete">
	    	<button type="submit" class="btn btn-default">Delete</button>

	    	<!-- Increment / decrement selected decks wins -->
	    	<h2>Change Wins</h2>
	    	<input type="text" name="wins">
	    	<button type="submit" class="btn btn-default">Update</button>

	    	<!-- Increment / decrement selected deck losses -->
	    	<h2>Change Losses</h2>
	    	<input type="text" name="losses">
	    	<button type="submit" class="btn btn-default">Update</button>
	    </form>

	    <form method="POST">
	    	<!-- Delete a deck -->
	    	<h2>Delete Deck</h2>
			<select id="deleteDeck" name="deleteDeck" class="selectpicker form-control">
				{% for item in decks %}
				<option value="{{ item }}">{{ item }}</option>
				{% endfor %}
			</select>
			<script>
				var lastVal = $('#deleteDeck option:last').val();
				$('#deleteDeck').val(lastVal);
			</script>
			<button type="submit" class="btn btn-default">Delete</button>
		</form>

	</div>

	<!-- Div for displaying all data about cards -->
	<div class="tables">
		<div class="cards">
			<h1>All cards</h1>
			{{ cardList | safe }}
		</div>
		<div class="deck">
			<h1>Current deck: {{ deckName }}</h1>
			{{ activeDeck | safe }}
		</div>
	</div>

	<!-- card info popup -->
	<style>
		.cardinfolink {
			color: #00f;
			text-decoration: underline;
			cursor: pointer;
		}
		.hide {
			display: none;
		}
		#cardinfomodal {
			background-color: rgba(0,0,0,0.5);
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 1000;
			padding: 30px 0;
		}
		#cardinfoiframe {
			display: inline-block;
			width: calc(100% - 60px);
			height: calc(100% - 60px);
		}
	</style>
	<div id="cardinfomodal" class="hide">
		<iframe id="cardinfoiframe"></iframe>
	</div>
	<script>
		// set up table links
		var table = document.getElementsByClassName('dataframe')[0];
		var rows = table.getElementsByTagName('tr');
		for (var i = 1; i < rows.length; i++) {
			(function(i) {
				var row = rows[i];
				var cardcode = row.children[1].innerHTML;
				var cardnametd = row.children[2];
				var cardname = cardnametd.innerHTML;
				cardnametd.innerHTML = "";
				var link = document.createElement('div');
				link.classList = "cardinfolink";
				link.innerHTML = cardname;
				link.addEventListener('click', e => {
					openModal(cardcode);
				});
				cardnametd.appendChild(link);
			}(i));
		}

		// modal functions
		var modal = document.getElementById('cardinfomodal');
		modal.addEventListener('click', closeModal);
		function closeModal() {
			modal.classList.toggle('hide');
		}
		function openModal(el) {
			var iframe = document.getElementById('cardinfoiframe');
			modal.classList.toggle('hide');
			iframe.src = "/gallery/" + el + "?hideback=true";
		}
	</script>

</div>
{% endblock %}